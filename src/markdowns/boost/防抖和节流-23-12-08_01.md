### **防抖（debounce）**

- 定义: 频繁的触发某个操作，若在指定的时间间隔内，则只会在最后一次操作后，执行对应的后续动作; 超过这个时间间隔，触发操作后会再次执行。

- 适用场景:

  - 输入框输入触发操作（搜索）
  - 按钮点击触发操作（登录、发短信等按钮避免用户点击太快，以致于发送了多次请求）
  - 窗口大小 Resize。只需窗口调整完成后，计算窗口大小。防止重复渲染。
  - 文本编辑器实时保存，当无任何更改操作一秒后进行保存。

- 代码实现:

  ```js
  function debounce(func, delay) {
    let timer = null;
    return function () {
      const context = this;
      const args = arguments;
      if (timer) {
        clearTimeout(timer);
      }
      timer = setTimeout(() => {
        func.apply(context, args);
      }, delay);
    };
  }
  ```

### **节流（throttle）**

- 定义: 一段时间间隔内，第一次触发完后，再此时间间隔未结束之前，触发任何操作都不会执行对应的后续动作。

- 适用场景:

  - 监听滚动条事件（scroll 事件，每隔一秒计算一次位置信息等）
  - 浏览器播放事件，每个一秒计算一次进度信息等
  - input 框实时搜索并发送请求展示下拉列表，每隔一秒发送一次请求 (也可做防抖)
  - 修改内容自动保存

- 代码实现:

  - 计时器实现

  ```js
  function throttle(func, delay) {
    let timer = null;
    return function () {
      const context = this;
      const args = arguments;
      if (timer) {
        return;
      }
      timer = setTimeout(() => {
        func.apply(context, args);
        timer = null;
      }, delay);
    };
  }
  ```

  - 时间戳实现

  ```js
  function throttle(func, delay) {
    let currTime = 0;
    return function () {
      const context = this;
      const args = arguments;
      const nowTime = Date.now();
      if (nowTime - currTime > delay) {
        func.apply(context, args);
        currTime = nowTime;
      }
    };
  }
  ```

### 实践

- 在 vue 中将防抖封装为指令

  ```js
  import { createApp } from "vue";
  import App from "./App.vue";

  const app = createApp(App);
  /**
   * @description 主要用于按钮频繁点击的防抖处理  v-debounce:delay=执行方法； delay默认为 500
   */
  app.directive("debounce", {
    mounted: (el, binding) => {
      el.addEventListener("click", () => {
        const delay: number = (binding.arg && parseInt(binding.arg)) || 500;
        el.disabled = true;
        setTimeout(() => {
          el.disabled = false;
          binding.value();
        }, delay);
      });
    },
    beforeUnmount(el) {
      el.removeEventListener("click", () => {});
    },
  });
  ```
