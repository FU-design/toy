<!DOCTYPE html>
<html>

<head>
  <title>Dynamic Node Connections</title>
  <style>
    .node {
      width: 20px;
      height: 20px;
      background-color: red;
      position: absolute;
    }

    svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }

    svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
    }
  </style>
</head>

<body>
  <button id="addNode">Add Node</button>
  <svg id="svg"></svg>

  <script>
    document.getElementById('addNode').addEventListener('click', addNode);

    let nodes = [];
    let nodeId = 0;

    function addNode() {
      let newNode = document.createElement('div');
      newNode.className = 'node';
      newNode.id = `node${nodeId++}`;
      newNode.style.top = `${Math.random() * (window.innerHeight - 20)}px`;
      newNode.style.left = `${Math.random() * (window.innerWidth - 20)}px`;

      document.body.appendChild(newNode);
      newNode.addEventListener('click', connectNodes);

      nodes.push(newNode);

      if (nodes.length > 1) {
        drawLine(nodes[nodes.length - 2], newNode);
      }
    }

    function drawLine(from, to) {
      let svg = document.getElementById('svg');
      let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');

      let fromRect = from.getBoundingClientRect();
      let toRect = to.getBoundingClientRect();

      line.setAttribute('x1', fromRect.left + fromRect.width / 2);
      line.setAttribute('y1', fromRect.top + window.scrollY + fromRect.height / 2);
      line.setAttribute('x2', toRect.left + toRect.width / 2);
      line.setAttribute('y2', toRect.top + window.scrollY + toRect.height / 2);
      line.setAttribute('stroke', 'black');

      svg.appendChild(line);
    }

    function connectNodes(event) {
      // 预留功能：点击已有节点进行连接操作。
      event.stopPropagation(); // 阻止事件冒泡导致的重复添加
    }
  </script>
</body>

</html>